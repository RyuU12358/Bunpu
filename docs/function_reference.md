# Bunpu 関数一覧

確率分布スプレッドシート「Bunpu」で使用できる関数の一覧です。

## 分布生成関数

| 関数名                          | 説明                             | 引数                                    |
| ------------------------------- | -------------------------------- | --------------------------------------- |
| `CONST(x)`                      | 定数（スカラー）分布を作成       | `x`: 値                                 |
| `UNIFORM(min, max)`             | 一様分布を生成                   | `min`: 最小値, `max`: 最大値            |
| `NORMAL(mean, std)`             | 正規分布を生成                   | `mean`: 平均, `std`: 標準偏差           |
| `DISCRETE(v1, p1, v2, p2, ...)` | 離散分布を生成                   | 値と確率のペアを交互に指定              |
| `CHOICE(v1, w1, v2, w2, ...)`   | 重み付き選択分布（正規化される） | 値と重みのペアを交互に指定              |
| `EXPONENTIAL(rate)`             | 指数分布を生成                   | `rate`: レート(λ)                       |
| `POISSON(lambda)`               | ポアソン分布を生成               | `lambda`: 期待値(λ)                     |
| `BINOMIAL(n, p)`                | 二項分布を生成                   | `n`: 試行回数, `p`: 成功確率            |
| `BIN(a, b, [p])`                | 区間分布（内部用）               | `a`: 下限, `b`: 上限, `p`: 確率(省略可) |

## 演算関数

| 関数名             | 説明                                       | 引数                        |
| ------------------ | ------------------------------------------ | --------------------------- |
| `ADD(A, B)`        | 2 つの分布を加算（畳み込み）               | `A, B`: 分布またはスカラー  |
| `SUB(A, B)`        | 分布の減算                                 | `A, B`: 分布またはスカラー  |
| `MUL(A, B)`        | スカラー倍（Dist \* Scalar のみ）          | `A, B`: 一方がスカラー      |
| `DIV(A, B)`        | 除算（Dist / Scalar または Scalar / Dist） | `A, B`: 一方がスカラー      |
| `SCALE(A, k)`      | 分布を k 倍                                | `A`: 分布, `k`: スカラー    |
| `SHIFT(Dist, k)`   | 分布を k だけシフト(X + k)                 | `Dist`: 分布, `k`: シフト量 |
| `POWER(Dist, exp)` | 分布のべき乗                               | `Dist`: 分布, `exp`: 指数   |
| `MIX(p, A, B)`     | 混合分布（確率 p で A、1-p で B）          | `p`: 確率, `A, B`: 分布     |
| `CONVOLVE(A, B)`   | 畳み込み（ADD と同じ）                     | `A, B`: 分布                |

## 繰り返し関数（パチンコ計算向け）

| 関数名                | 説明                                  | 引数                              |
| --------------------- | ------------------------------------- | --------------------------------- |
| `GEOM_SUM(Dist, p)`   | 幾何分布的繰り返しの和（RUSH 計算用） | `Dist`: 1 回の分布, `p`: 継続確率 |
| `REPEAT_ADD(Dist, N)` | 分布を N 回加算                       | `Dist`: 1 回の分布, `N`: 回数     |

## 統計関数

| 関数名             | 説明            | 引数                    |
| ------------------ | --------------- | ----------------------- |
| `MEAN(Dist)`       | 平均（期待値）  | `Dist`: 分布            |
| `VAR(Dist)`        | 分散            | `Dist`: 分布            |
| `STD(Dist)`        | 標準偏差        | `Dist`: 分布            |
| `MEDIAN(Dist)`     | 中央値          | `Dist`: 分布            |
| `PROB_GT(Dist, x)` | P(X > x) を計算 | `Dist`: 分布, `x`: 閾値 |

## 高度な分析関数

| 関数名                             | 説明                       | 引数                                                            |
| ---------------------------------- | -------------------------- | --------------------------------------------------------------- |
| `RUIN_PROB(StepDist, Init, Steps)` | 破産確率を計算             | `StepDist`: 1 回の収支分布, `Init`: 初期資金, `Steps`: 試行回数 |
| `MAX_OF(Dist, N)`                  | N 個のサンプルの最大値分布 | `Dist`: 分布, `N`: 個数                                         |

## ユーティリティ関数

| 関数名                  | 説明                                 | 引数                            |
| ----------------------- | ------------------------------------ | ------------------------------- |
| `RESAMPLE(Dist, N)`     | N 点でリサンプル                     | `Dist`: 分布, `N`: サンプル数   |
| `REDUCE(Dist, targetN)` | コンポーネント数を削減               | `Dist`: 分布, `targetN`: 目標数 |
| `CONFIG(limit, expr)`   | コンポーネント上限を設定して式を評価 | `limit`: 上限, `expr`: 式       |
| `REF(cell)`             | セル参照（内部用）                   | `cell`: セル名                  |

## 入力例

```
=DISCRETE(1000, 0.2, 600, 0.2, 300, 0.6)
=ADD(CONST(400), GEOM_SUM(DISCRETE(1000, 0.2, 300, 0.8), 0.7))
=MIX(0.5, NORMAL(100, 10), CONST(0))
=RUIN_PROB(ADD(MIX(0.01, CONST(1500), CONST(0)), -14), 50000, 1000)
```
