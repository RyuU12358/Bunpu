# GEOM_SUM 関数の活用ガイド (パチンコ LT 対応)

## 概要

新しく追加された `GEOM_SUM(Dist, Prob)` は、「確率 `Prob` で継続し続ける限り、分布 `Dist` を足し合わせる」という計算を行います。
これはパチンコの「確変・ST」や、ゲームの「確率発動コンボ」などのシミュレーションに最適です。

特に、最近流行の「ラッキートリガー（LT）」のような、下位 RUSH から上位 RUSH への昇格を含む複雑な出玉計算も、この関数を組み合わせることで正確に表現できます。

## 基本的な使い方

### 1. 単純な ST・確変（突入時点で 1 回当確 + 以降継続）

例: 大当たり出玉 1500 発、継続率 81%の RUSH

```excel
ADD(CONST(1500), GEOM_SUM(CONST(1500), 0.81))
```

- `ADD(CONST(1500), ...)`: 最初の 1 回分（確約）
- `GEOM_SUM(..., 0.81)`: 2 連目以降の継続分（81%で継続する限り加算）

### 2. ループタイプ（次回まで継続）

次回大当たりが確約されている場合も、数式は上記と同じ形になります（初回 + 連チャン分）。

## 応用: ラッキートリガー (LT) の計算

「下位 RUSH 終了時の一部で、上位 RUSH(LT)に突入する」というスペックを計算する場合、以下のモデルで表現します。

**モデルの考え方**:
`総出玉 = [下位RUSHの出玉] + [LT突入チャンス(MIX)]`

### 計算式テンプレート

```excel
ADD(
  Basic_Rush,                   // 下位RUSHの全出玉
  MIX(Promote_Rate, LT_Rush, 0) // 下位終了時に運良くLTに入ればプラス、ダメなら0
)
```

### 具体例: 北斗の拳 LT (架空スペック)

- **下位 RUSH**: 出玉 400 発、継続率 70%
- **昇格**: 下位終了時の 10% で LT へ突入
- **上位 RUSH (LT)**: 出玉 1500 発、継続率 95%

**数式**:

```excel
ADD(
  // 1. 下位RUSH (初回 + 継続70%)
  ADD(CONST(400), GEOM_SUM(CONST(400), 0.7)),

  // 2. LTチャンス
  // 昇格率 10% (=0.1)。入ればLT、入らなければ 0 (終了)。
  MIX(0.1,
    // LT出玉 (突入時1回 + 継続95%)
    ADD(CONST(1500), GEOM_SUM(CONST(1500), 0.95)),
    CONST(0)
  )
)
```

### 注意点

- **継続率の定義**: `GEOM_SUM` の第 2 引数は「継続率」です。
- **昇格率の定義**: ここでの `MIX` の第 1 引数 (`0.1`) は、「下位 RUSH が**終わった後**に LT に行く確率」です。
  - ※もしスペック表に「ラッシュ中当たりの 3% で昇格」とある場合は計算が少し異なりますが、多くの LT 機は「残保留での引き戻し」や「転落時の一部」で突入するため、上記の「終了後分岐モデル」で近似可能です。

## `GEOM_SUM` vs `REPEAT_ADD`

| 関数               | 確率的変動            | 用途                                                         |
| ------------------ | --------------------- | ------------------------------------------------------------ |
| `REPEAT_ADD(D, N)` | **なし** (N 回固定)   | 平均的な出玉期待値だけ知りたい時（計算が速い）               |
| `GEOM_SUM(D, p)`   | **あり** (0 回〜無限) | 「即落ち」や「大連チャン」を含む**リアルな分布**を知りたい時 |

LT 機のように「分散（荒れ具合）」が重要なスペックでは、`GEOM_SUM` を使うことを強く推奨します。
